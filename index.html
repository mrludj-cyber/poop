<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ë‚˜ë§Œì˜ ë°°ë³€ ì§€ë„ ğŸ’©</title>
    <style>
        body, html { height: 100%; margin: 0; padding: 0; font-family: sans-serif; }
        #map { height: 100%; width: 100%; }
        
        .btn-container {
            position: absolute;
            bottom: 40px;
            width: 100%;
            text-align: center;
            z-index: 5;
        }

        #poop-btn {
            background-color: #8B4513;
            color: white;
            border: none;
            padding: 15px 35px;
            font-size: 22px;
            border-radius: 50px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.4);
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.1s;
        }
        #poop-btn:active { transform: scale(0.95); background-color: #5D2906; }
        
        /* ê¸°ë¡ ì‚­ì œ ë²„íŠ¼ (ì‘ê²Œ) */
        #reset-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 5;
            background: rgba(255, 255, 255, 0.8);
            border: 1px solid #ccc;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 12px;
            cursor: pointer;
        }
    </style>
</head>
<body>

    <button id="reset-btn" onclick="resetData()">ğŸ—‘ï¸ ê¸°ë¡ ì´ˆê¸°í™”</button>
    <div id="map"></div>
    
    <div class="btn-container">
        <button id="poop-btn" onclick="savePoop()">ğŸ’© ì—¬ê¸°ì„œ ìŒˆ!</button>
    </div>

    <!-- êµ¬ê¸€ ë§µ API -->
    <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyA5LgbtPjepR9nuQ4TUjyRknmC9JgKodWo&callback=initMap">
    </script>

    <script>
        let map;
        let markers = [];

        // 1. ì§€ë„ ì´ˆê¸°í™”
        function initMap() {
            // ì„œìš¸ ì‹œì²­ ê¸°ë³¸ ì¢Œí‘œ
            const startPos = { lat: 37.5665, lng: 126.9780 };
            
            map = new google.maps.Map(document.getElementById("map"), {
                zoom: 16,
                center: startPos,
                disableDefaultUI: false,
                gestureHandling: 'greedy' // ëª¨ë°”ì¼ í„°ì¹˜ê° ê°œì„ 
            });

            // ì €ì¥ëœ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
            loadPoops();

            // í˜„ì¬ ë‚´ ìœ„ì¹˜ë¡œ ì´ë™
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        const pos = {
                            lat: position.coords.latitude,
                            lng: position.coords.longitude,
                        };
                        map.setCenter(pos);
                        // ë‚´ ìœ„ì¹˜ íŒŒë€ ì 
                        new google.maps.Marker({
                            position: pos,
                            map: map,
                            icon: {
                                path: google.maps.SymbolPath.CIRCLE,
                                scale: 7,
                                fillColor: "#4285F4",
                                fillOpacity: 1,
                                strokeColor: "white",
                                strokeWeight: 2,
                            },
                        });
                    },
                    () => { console.log("ìœ„ì¹˜ ê¶Œí•œ ì‹¤íŒ¨"); }
                );
            }
        }

        // 2. ë˜¥ ê¸°ë¡ ì €ì¥ (LocalStorage ì‚¬ìš©)
        function savePoop() {
            if (!navigator.geolocation) {
                alert("ë¸Œë¼ìš°ì €ê°€ ìœ„ì¹˜ ì •ë³´ë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");
                return;
            }

            navigator.geolocation.getCurrentPosition((position) => {
                const lat = position.coords.latitude;
                const lng = position.coords.longitude;
                const time = new Date().toLocaleString();

                const poopData = { lat: lat, lng: lng, time: time };

                // ê¸°ì¡´ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
                let poopList = JSON.parse(localStorage.getItem('myPoopList')) || [];
                
                // ìƒˆ ë°ì´í„° ì¶”ê°€
                poopList.push(poopData);
                
                // ë‹¤ì‹œ ì €ì¥
                localStorage.setItem('myPoopList', JSON.stringify(poopList));

                // ì§€ë„ì— ë§ˆì»¤ ì°ê¸°
                addMarker(lat, lng, time);
                
                alert("ì„±ê³µì ìœ¼ë¡œ ì˜ì—­ì„ í‘œì‹œí–ˆìŠµë‹ˆë‹¤! ğŸ’©");
            });
        }

        // 3. ì €ì¥ëœ ë˜¥ ê¸°ë¡ ë¶ˆëŸ¬ì˜¤ê¸°
        function loadPoops() {
            let poopList = JSON.parse(localStorage.getItem('myPoopList')) || [];
            poopList.forEach(data => {
                addMarker(data.lat, data.lng, data.time);
            });
        }

        // 4. ì§€ë„ì— ë§ˆì»¤ ì¶”ê°€í•˜ëŠ” í•¨ìˆ˜
        function addMarker(lat, lng, title) {
            new google.maps.Marker({
                position: { lat: lat, lng: lng },
                map: map,
                title: title,
                // ê¸°ë³¸ ë¹¨ê°„ í•€ (ì›í•˜ë©´ ğŸ’© ì´ë¯¸ì§€ urlë¡œ ë³€ê²½ ê°€ëŠ¥)
                animation: google.maps.Animation.DROP 
            });
        }

        // 5. ê¸°ë¡ ì´ˆê¸°í™”
        function resetData() {
            if(confirm("ì •ë§ ëª¨ë“  ë°°ë³€ ê¸°ë¡ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
                localStorage.removeItem('myPoopList');
                location.reload(); // ìƒˆë¡œê³ ì¹¨
            }
        }
    </script>
</body>
</html>