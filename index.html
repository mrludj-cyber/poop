<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ë‹¤ëŒì¥ì˜ ë°°ë³€ ì •ë³µê¸° ğŸ¿ï¸</title>
    <style>
        /* --- ê¸°ë³¸ ìŠ¤íƒ€ì¼ --- */
        body, html { height: 100%; margin: 0; padding: 0; font-family: 'Apple SD Gothic Neo', sans-serif; background-color: #f5f5f5; }
        
        /* --- íƒ­ ë©”ë‰´ (í•˜ë‹¨) --- */
        .tab-bar {
            position: fixed; bottom: 0; width: 100%; height: 60px;
            background: white; display: flex; justify-content: space-around;
            align-items: center; border-top: 1px solid #ddd; z-index: 10;
        }
        .tab-item { flex: 1; text-align: center; padding: 10px; font-size: 14px; color: #888; cursor: pointer; }
        .tab-item.active { color: #8B4513; font-weight: bold; }
        .tab-icon { display: block; font-size: 20px; margin-bottom: 2px; }

        /* --- ë©”ì¸ í™”ë©´ ì»¨í…Œì´ë„ˆ --- */
        #map-container { height: calc(100% - 60px); width: 100%; position: absolute; top: 0; }
        #list-container { height: calc(100% - 60px); width: 100%; position: absolute; top: 0; background: #fdfdfd; display: none; overflow-y: auto; padding-bottom: 20px; }

        /* --- ì •ë³µ ì™„ë£Œ ë²„íŠ¼ --- */
        #conquer-btn {
            position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%);
            z-index: 5; background-color: #8B4513; color: white;
            border: 3px solid #D2691E; padding: 15px 40px; font-size: 20px;
            border-radius: 50px; box-shadow: 0 4px 10px rgba(0,0,0,0.4);
            font-weight: bold; cursor: pointer; display: flex; align-items: center; gap: 10px;
        }
        #conquer-btn:active { transform: translateX(-50%) scale(0.95); background-color: #5D2906; }

        /* --- ì •ë³µ ë¦¬ìŠ¤íŠ¸ ìŠ¤íƒ€ì¼ --- */
        .stats-box {
            background: #8B4513; color: white; padding: 20px; text-align: center;
            border-bottom-left-radius: 20px; border-bottom-right-radius: 20px;
        }
        .stats-title { font-size: 14px; opacity: 0.9; margin-bottom: 5px; }
        .stats-count { font-size: 28px; font-weight: bold; }
        
        .log-item {
            background: white; margin: 15px; padding: 15px; border-radius: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05); position: relative;
        }
        .log-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .log-flag { font-size: 24px; margin-right: 10px; }
        .log-place { font-weight: bold; font-size: 18px; color: #333; }
        .log-addr { font-size: 12px; color: #777; margin-bottom: 10px; }
        .log-note { 
            background: #f9f9f9; padding: 10px; border-radius: 8px; font-size: 14px; 
            color: #555; border-left: 3px solid #8B4513; 
        }
        .btn-edit { 
            position: absolute; top: 15px; right: 15px; font-size: 20px; 
            cursor: pointer; background: none; border: none; 
        }

        /* --- ì¸íŠ¸ë¡œ í™”ë©´ (ìŠ¤í”Œë˜ì‹œ) --- */
        #intro-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #FFF8E1; z-index: 9999;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            transition: opacity 1s ease-out;
        }
        .earth { font-size: 80px; animation: spin 4s linear infinite; }
        .squirrel-intro { font-size: 60px; position: absolute; margin-top: -50px; animation: walk 1s ease-in-out infinite alternate; }
        @keyframes spin { 100% { transform: rotate(360deg); } }
        @keyframes walk { from { transform: translateY(0); } to { transform: translateY(-10px); } }
        .intro-text { margin-top: 40px; font-size: 24px; font-weight: bold; color: #8B4513; }

        /* --- ìˆ˜ì • ëª¨ë‹¬ì°½ --- */
        #edit-modal {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5); z-index: 100; justify-content: center; align-items: center;
        }
        .modal-content {
            background: white; padding: 25px; border-radius: 15px; width: 80%;
        }
        .modal-content h3 { margin-top: 0; color: #8B4513; }
        .modal-input { width: 100%; padding: 10px; margin-bottom: 10px; box-sizing: border-box; border: 1px solid #ddd; border-radius: 5px; }
        .modal-btns { display: flex; justify-content: flex-end; gap: 10px; }
        .modal-btn { padding: 8px 15px; border-radius: 5px; border: none; cursor: pointer; }
        .btn-save { background: #8B4513; color: white; }
        .btn-cancel { background: #ddd; }
    </style>
</head>
<body>

    <!-- 1. ì¸íŠ¸ë¡œ í™”ë©´ -->
    <div id="intro-screen">
        <div style="position: relative; display: flex; justify-content: center;">
            <div class="earth">ğŸŒ</div>
            <div class="squirrel-intro">ğŸ¿ï¸</div>
        </div>
        <div class="intro-text">ì„¸ê³„ ì •ë³µí•˜ëŸ¬ ê°€ëŠ” ì¤‘...</div>
    </div>

    <!-- 2. ë©”ì¸ ì§€ë„ íƒ­ -->
    <div id="map-container">
        <div id="map" style="width: 100%; height: 100%;"></div>
        <button id="conquer-btn" onclick="conquerCurrentLocation()">
            <span>ğŸš©</span> ì •ë³µ ì™„ë£Œ!
        </button>
    </div>

    <!-- 3. ì •ë³µ ë¦¬ìŠ¤íŠ¸ íƒ­ -->
    <div id="list-container">
        <div class="stats-box">
            <div class="stats-title">í˜„ì¬ ë‹¤ëŒì¥ì˜ ì •ë³µ í˜„í™©</div>
            <div class="stats-count" id="total-count">0ê³³ ì •ë³µí•¨</div>
            <div style="margin-top: 10px; font-size: 14px;" id="country-stats"></div>
        </div>
        <div id="log-list-area">
            <!-- ê¸°ë¡ë“¤ì´ ì—¬ê¸°ì— ì¶”ê°€ë¨ -->
        </div>
    </div>

    <!-- 4. í•˜ë‹¨ íƒ­ë°” -->
    <div class="tab-bar">
        <div class="tab-item active" onclick="switchTab('map')" id="tab-map">
            <span class="tab-icon">ğŸ—ºï¸</span>ì§€ë„
        </div>
        <div class="tab-item" onclick="switchTab('list')" id="tab-list">
            <span class="tab-icon">ğŸ“œ</span>ì •ë³µ ë¦¬ìŠ¤íŠ¸
        </div>
    </div>

    <!-- 5. ìˆ˜ì • ëª¨ë‹¬ -->
    <div id="edit-modal">
        <div class="modal-content">
            <h3>ì •ë³µ ê¸°ë¡ ìˆ˜ì • ğŸ¿ï¸</h3>
            <input type="text" id="edit-place" class="modal-input" placeholder="ì¥ì†Œ ì´ë¦„ (ì˜ˆ: ìš°ë¦¬ì§‘ í™”ì¥ì‹¤)">
            <textarea id="edit-note" class="modal-input" rows="3" placeholder="ë©”ëª¨ (ì˜ˆ: íœ´ì§€ê°€ ë½€ì†¡í–ˆìŒ)"></textarea>
            <input type="hidden" id="edit-id">
            <div class="modal-btns">
                <button class="modal-btn btn-cancel" onclick="closeModal()">ì·¨ì†Œ</button>
                <button class="modal-btn btn-save" onclick="saveEdit()">ì €ì¥</button>
            </div>
            <button onclick="deleteLog()" style="margin-top:10px; width:100%; background:none; border:none; color:red;">ì‚­ì œí•˜ê¸°</button>
        </div>
    </div>

    <!-- êµ¬ê¸€ ë§µ API (Geocoding ë¼ì´ë¸ŒëŸ¬ë¦¬ ì¶”ê°€ë¨) -->
    <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyA5LgbtPjepR9nuQ4TUjyRknmC9JgKodWo&libraries=places&callback=initMap">
    </script>

    <script>
        let map;
        let markers = [];
        let geocoder;

        // --- ì´ˆê¸°í™” ë° ì¸íŠ¸ë¡œ ---
        function initMap() {
            // ì¸íŠ¸ë¡œ 2.5ì´ˆ í›„ ì‚¬ë¼ì§
            setTimeout(() => {
                document.getElementById('intro-screen').style.opacity = '0';
                setTimeout(() => {
                    document.getElementById('intro-screen').style.display = 'none';
                }, 1000);
            }, 2500);

            geocoder = new google.maps.Geocoder();

            const startPos = { lat: 37.5665, lng: 126.9780 };
            map = new google.maps.Map(document.getElementById("map"), {
                zoom: 16,
                center: startPos,
                disableDefaultUI: false,
                clickableIcons: false // ì§€ë„ ìœ„ ìƒì  í´ë¦­ ë°©ì§€
            });

            loadConquests(); // ì €ì¥ëœ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°

            // í˜„ì¬ ìœ„ì¹˜ë¡œ ì´ë™
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition((position) => {
                    const pos = {
                        lat: position.coords.latitude,
                        lng: position.coords.longitude,
                    };
                    map.setCenter(pos);
                    // íƒí—˜ê°€ ë‹¤ëŒì¥ ë§ˆì»¤ (ë‚´ ìœ„ì¹˜)
                    new google.maps.Marker({
                        position: pos,
                        map: map,
                        label: { text: "ğŸ¿ï¸", fontSize: "30px" },
                        zIndex: 999
                    });
                });
            }
        }

        // --- ì •ë³µ ê¸°ëŠ¥ (ìœ„ì¹˜ ì €ì¥) ---
        function conquerCurrentLocation() {
            if (!navigator.geolocation) {
                alert("ìœ„ì¹˜ ì •ë³´ë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
                return;
            }

            navigator.geolocation.getCurrentPosition((position) => {
                const lat = position.coords.latitude;
                const lng = position.coords.longitude;
                const latlng = { lat: lat, lng: lng };

                // ì£¼ì†Œ ê°€ì ¸ì˜¤ê¸° (Geocoding)
                geocoder.geocode({ location: latlng }, (results, status) => {
                    let country = "ë¯¸ì§€ì˜ ë•…";
                    let region = "ì–´ë”˜ê°€";
                    let flag = "ğŸ³ï¸";

                    if (status === "OK" && results[0]) {
                        // ì£¼ì†Œ ë¶„ì„
                        const addressComponents = results[0].address_components;
                        addressComponents.forEach(component => {
                            if (component.types.includes("country")) {
                                country = component.long_name;
                                if(country === "ëŒ€í•œë¯¼êµ­") flag = "ğŸ‡°ğŸ‡·";
                                else if(country === "ë¯¸êµ­") flag = "ğŸ‡ºğŸ‡¸";
                                else if(country === "ì¼ë³¸") flag = "ğŸ‡¯ğŸ‡µ";
                                else flag = "ğŸš©";
                            }
                            if (component.types.includes("administrative_area_level_1")) {
                                region = component.long_name; // ì‹œ/ë„
                            }
                        });
                    }

                    const newConquest = {
                        id: Date.now(), // ê³ ìœ  ID
                        lat: lat,
                        lng: lng,
                        time: new Date().toLocaleDateString() + " " + new Date().toLocaleTimeString(),
                        country: country,
                        region: region,
                        flag: flag,
                        placeName: `${region}ì˜ ì–´ëŠ í™”ì¥ì‹¤`,
                        note: "ì•„ì§ ë©”ëª¨ê°€ ì—†ìŠµë‹ˆë‹¤."
                    };

                    // ì €ì¥
                    let list = getList();
                    list.push(newConquest);
                    saveList(list);
                    
                    addMarker(newConquest);
                    alert("ì •ë³µ ì™„ë£Œ! ğŸ¿ï¸\në¦¬ìŠ¤íŠ¸ íƒ­ì—ì„œ ë‚´ìš©ì„ ìˆ˜ì •í•  ìˆ˜ ìˆì–´ìš”.");
                });
            });
        }

        // --- ë§ˆì»¤ í‘œì‹œ ---
        function addMarker(data) {
            const marker = new google.maps.Marker({
                position: { lat: data.lat, lng: data.lng },
                map: map,
                label: { text: "ğŸ’©", fontSize: "20px" } // ë˜¥ ë§ˆì»¤
            });
            
            const infoWindow = new google.maps.InfoWindow({
                content: `<div style="text-align:center;"><b>${data.placeName}</b><br>${data.time}</div>`
            });

            marker.addListener("click", () => {
                infoWindow.open(map, marker);
            });
        }

        // --- ë°ì´í„° ê´€ë¦¬ (LocalStorage) ---
        function getList() {
            return JSON.parse(localStorage.getItem('conquestList')) || [];
        }
        function saveList(list) {
            localStorage.setItem('conquestList', JSON.stringify(list));
            renderList(); // ë¦¬ìŠ¤íŠ¸ í™”ë©´ ê°±ì‹ 
        }

        function loadConquests() {
            const list = getList();
            list.forEach(item => addMarker(item));
            renderList();
        }

        // --- ë¦¬ìŠ¤íŠ¸ í™”ë©´ ë Œë”ë§ & í†µê³„ ---
        function renderList() {
            const list = getList().reverse(); // ìµœì‹ ìˆœ ì •ë ¬
            const container = document.getElementById('log-list-area');
            container.innerHTML = "";

            // í†µê³„ ê³„ì‚°
            document.getElementById('total-count').innerText = `${list.length}ê³³ ì •ë³µí•¨`;
            const countryCounts = {};
            list.forEach(item => {
                countryCounts[item.country] = (countryCounts[item.country] || 0) + 1;
            });
            let statsText = [];
            for (const [country, count] of Object.entries(countryCounts)) {
                statsText.push(`${country}: ${count}`);
            }
            document.getElementById('country-stats').innerText = statsText.join(' | ');

            // ë¦¬ìŠ¤íŠ¸ ìƒì„±
            list.forEach(item => {
                const div = document.createElement('div');
                div.className = 'log-item';
                div.innerHTML = `
                    <div class="log-header">
                        <div>
                            <span class="log-flag">${item.flag}</span>
                            <span class="log-place">${item.placeName}</span>
                        </div>
                        <button class="btn-edit" onclick="openEditModal(${item.id})">âœ</button>
                    </div>
                    <div class="log-addr">${item.country} ${item.region} | ${item.time}</div>
                    <div class="log-note">${item.note}</div>
                `;
                container.appendChild(div);
            });
        }

        // --- ìˆ˜ì • ëª¨ë‹¬ ê´€ë ¨ ---
        function openEditModal(id) {
            const list = getList();
            const item = list.find(x => x.id === id);
            if(item) {
                document.getElementById('edit-id').value = id;
                document.getElementById('edit-place').value = item.placeName;
                document.getElementById('edit-note').value = item.note;
                document.getElementById('edit-modal').style.display = 'flex';
            }
        }

        function closeModal() {
            document.getElementById('edit-modal').style.display = 'none';
        }

        function saveEdit() {
            const id = parseInt(document.getElementById('edit-id').value);
            const newName = document.getElementById('edit-place').value;
            const newNote = document.getElementById('edit-note').value;

            let list = getList();
            const index = list.findIndex(x => x.id === id);
            if(index !== -1) {
                list[index].placeName = newName;
                list[index].note = newNote;
                saveList(list);
                closeModal();
            }
        }

        function deleteLog() {
            if(confirm("ì´ ì •ë³µ ê¸°ë¡ì„ ì‚­ì œí• ê¹Œìš”?")) {
                const id = parseInt(document.getElementById('edit-id').value);
                let list = getList();
                list = list.filter(x => x.id !== id);
                saveList(list);
                closeModal();
                location.reload(); // ë§ˆì»¤ ì‚­ì œë¥¼ ìœ„í•´ ìƒˆë¡œê³ ì¹¨ì´ ì œì¼ ê¹”ë”í•¨
            }
        }

        // --- íƒ­ ì „í™˜ ---
        function switchTab(tabName) {
            if (tabName === 'map') {
                document.getElementById('map-container').style.display = 'block';
                document.getElementById('list-container').style.display = 'none';
                document.getElementById('tab-map').classList.add('active');
                document.getElementById('tab-list').classList.remove('active');
            } else {
                document.getElementById('map-container').style.display = 'none';
                document.getElementById('list-container').style.display = 'block';
                document.getElementById('tab-map').classList.remove('active');
                document.getElementById('tab-list').classList.add('active');
                renderList(); // ë¦¬ìŠ¤íŠ¸ íƒ­ ëˆ„ë¥¼ ë•Œë§ˆë‹¤ ê°±ì‹ 
            }
        }
    </script>
</body>
</html>
