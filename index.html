<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ë‹¤ëŒì¥ì˜ ë°°ë³€ ì •ë³µê¸° ğŸ¿ï¸</title>
    <style>
        /* --- ê¸°ë³¸ ìŠ¤íƒ€ì¼ --- */
        body, html { height: 100%; margin: 0; padding: 0; font-family: 'Apple SD Gothic Neo', sans-serif; background-color: #f5f5f5; overflow: hidden; }
        
        /* --- ì¸íŠ¸ë¡œ í™”ë©´ --- */
        #intro-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #FFF8E1; z-index: 9999;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            transition: opacity 1s ease-out;
        }

        .intro-container {
            position: relative;
            /* ê·¸ë¦¼ë“¤ì´ ì»¤ì§€ë‹ˆ ì»¨í…Œì´ë„ˆë„ ë„‰ë„‰í•˜ê²Œ í‚¤ì›Œì¤ë‹ˆë‹¤ */
            width: 300px;
            height: 400px; 
            display: flex;
            justify-content: center;
            align-items: flex-end;
            padding-bottom: 50px; /* ë°”ë‹¥ì—ì„œ ì¡°ê¸ˆ ë„ì›€ */
        }

        .intro-globe { 
            /* 1:1 ë¹„ìœ¨ì„ ìœ„í•´ ë‹¤ëŒì¥ë‘ ë˜‘ê°™ì´ ë§ì¶¤ */
            width: 100px; 
            height: 100px;
            z-index: 1; 
            animation: spin 10s linear infinite; 
            margin-bottom: 20px; /* ë°”ë‹¥ì—ì„œ ì•½ê°„ ë„ì›€ */
        }

        .intro-squirrel { 
            position: absolute;
            
            /* í•µì‹¬: ì§€êµ¬ë³¸ ë†’ì´(150px) + ì—¬ë°±(20px) - ë°œì´ ê²¹ì¹˜ëŠ” ì •ë„(35px) */
            /* ì´ ìˆ«ìë¥¼ ì¡°ì ˆí•˜ë©´ ë‹¤ëŒì¥ê°€ ìœ„ì•„ë˜ë¡œ ì›€ì§ì…ë‹ˆë‹¤ */
            bottom: 240px; 
            
            /* 1:1 ë¹„ìœ¨ì„ ìœ„í•´ ì§€êµ¬ë³¸ì´ë‘ ë˜‘ê°™ì´ ë§ì¶¤ */
            width: 240px; 
            left: 0;
            right: 0;
            margin-left: auto;
            margin-right: auto;
            
            z-index: 2; 
            animation: walk 0.6s ease-in-out infinite alternate;
        }
        
        @keyframes spin { 
            from { transform: rotate(0deg); } 
            to { transform: rotate(-360deg); } 
        }
        @keyframes walk { 
            from { transform: translateY(0) rotate(-5deg); } 
            to { transform: translateY(-15px) rotate(5deg); } 
        }

        .intro-text { 
            margin-top: 20px; font-size: 22px; font-weight: bold; color: #8B4513; 
            text-align: center; line-height: 1.5;
        }

        /* --- ê¸°ì¡´ UI ìœ ì§€ --- */
        .tab-bar { position: fixed; bottom: 0; width: 100%; height: 60px; background: white; display: flex; justify-content: space-around; align-items: center; border-top: 1px solid #ddd; z-index: 10; }
        .tab-item { flex: 1; text-align: center; padding: 10px; font-size: 14px; color: #888; cursor: pointer; }
        .tab-item.active { color: #8B4513; font-weight: bold; }
        .tab-icon { display: block; font-size: 20px; margin-bottom: 2px; }

        #map-container { height: calc(100% - 60px); width: 100%; position: absolute; top: 0; }
        #list-container { height: calc(100% - 60px); width: 100%; position: absolute; top: 0; background: #fdfdfd; display: none; overflow-y: auto; padding-bottom: 20px; }

        #conquer-btn {
            position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%);
            z-index: 5; background-color: #8B4513; color: white;
            border: 3px solid #D2691E; padding: 15px 30px; font-size: 18px;
            border-radius: 50px; box-shadow: 0 4px 10px rgba(0,0,0,0.4);
            font-weight: bold; cursor: pointer; display: flex; align-items: center; gap: 10px; white-space: nowrap;
        }
        #conquer-btn:active { transform: translateX(-50%) scale(0.95); background-color: #5D2906; }

        .stats-box { background: #8B4513; color: white; padding: 20px; text-align: center; border-bottom-left-radius: 20px; border-bottom-right-radius: 20px; }
        .stats-count { font-size: 28px; font-weight: bold; }
        .log-item { background: white; margin: 15px; padding: 15px; border-radius: 15px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); position: relative; }
        .log-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .log-place { font-weight: bold; font-size: 18px; color: #333; }
        .log-note { background: #f9f9f9; padding: 10px; border-radius: 8px; font-size: 14px; color: #555; border-left: 3px solid #8B4513; }
        .btn-edit { position: absolute; top: 15px; right: 15px; font-size: 20px; cursor: pointer; background: none; border: none; }

        #edit-modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 100; justify-content: center; align-items: center; }
        .modal-content { background: white; padding: 25px; border-radius: 15px; width: 80%; }
        .modal-input { width: 100%; padding: 10px; margin-bottom: 10px; box-sizing: border-box; border: 1px solid #ddd; border-radius: 5px; }
        .modal-btns { display: flex; justify-content: flex-end; gap: 10px; }
        .modal-btn { padding: 8px 15px; border-radius: 5px; border: none; cursor: pointer; }
        .btn-save { background: #8B4513; color: white; }
    </style>
</head>
<body>

    <div id="intro-screen">
        <div class="intro-container">
            <!-- 
               [ì¤‘ìš”] onerror ì†ì„±ì„ ì œê±°í–ˆìŠµë‹ˆë‹¤. 
               ì´ë¯¸ì§€ê°€ ì•ˆ ëœ¨ë©´ 'ê¹¨ì§„ ì•„ì´ì½˜'ì´ ë³´ì—¬ì•¼ ì •ìƒì…ë‹ˆë‹¤.
               ê¹¨ì§„ ì•„ì´ì½˜ì´ ë³´ì¸ë‹¤ë©´ íŒŒì¼ëª…/ê²½ë¡œ ë¬¸ì œì…ë‹ˆë‹¤.
            -->
            <img src="./squirrel.png" class="intro-squirrel" alt="ë‹¤ëŒì¥">
            <img src="./globe.png" class="intro-globe" alt="ì§€êµ¬ë³¸">
        </div>
        <div class="intro-text">
            ì§€êµ¬ ì •ë³µí•˜ëŸ¬<br>ì¶œë™í•œë‹¤ëŒì¥! ğŸ¿ï¸ğŸ’¨
        </div>
    </div>

    <!-- ì´í•˜ ì½”ë“œëŠ” ë™ì¼ -->
    <div id="map-container">
        <div id="map" style="width: 100%; height: 100%;"></div>
        <button id="conquer-btn" onclick="conquerCurrentLocation()">
            <span>ğŸš©</span> ì •ë³µ ì™„ë£Œ!
        </button>
    </div>

    <div id="list-container">
        <div class="stats-box">
            <div style="font-size: 14px; opacity: 0.9;">í˜„ì¬ ë‹¤ëŒì¥ì˜ ì •ë³µ í˜„í™©</div>
            <div class="stats-count" id="total-count">0ê³³ ì •ë³µí•¨</div>
            <div style="margin-top: 10px; font-size: 14px;" id="country-stats"></div>
        </div>
        <div id="log-list-area"></div>
    </div>

    <div class="tab-bar">
        <div class="tab-item active" onclick="switchTab('map')" id="tab-map">
            <span class="tab-icon">ğŸ—ºï¸</span>ì§€ë„
        </div>
        <div class="tab-item" onclick="switchTab('list')" id="tab-list">
            <span class="tab-icon">ğŸ“œ</span>ì •ë³µ ë¦¬ìŠ¤íŠ¸
        </div>
    </div>

    <div id="edit-modal">
        <div class="modal-content">
            <h3 style="margin-top:0; color:#8B4513;">ì •ë³µ ê¸°ë¡ ìˆ˜ì • ğŸ¿ï¸</h3>
            <input type="text" id="edit-place" class="modal-input" placeholder="ì¥ì†Œ ì´ë¦„">
            <textarea id="edit-note" class="modal-input" rows="3" placeholder="ë©”ëª¨"></textarea>
            <input type="hidden" id="edit-id">
            <div class="modal-btns">
                <button class="modal-btn" onclick="closeModal()" style="background:#ddd;">ì·¨ì†Œ</button>
                <button class="modal-btn btn-save" onclick="saveEdit()">ì €ì¥</button>
            </div>
            <button onclick="deleteLog()" style="margin-top:10px; width:100%; background:none; border:none; color:red; cursor:pointer;">ì‚­ì œí•˜ê¸°</button>
        </div>
    </div>

    <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyA5LgbtPjepR9nuQ4TUjyRknmC9JgKodWo&libraries=places&callback=initMap">
    </script>

    <script>
        let map;
        let geocoder;

        function initMap() {
            // ì¸íŠ¸ë¡œ í™”ë©´ 3ì´ˆ í›„ ì‚¬ë¼ì§
            setTimeout(() => {
                document.getElementById('intro-screen').style.opacity = '0';
                setTimeout(() => {
                    document.getElementById('intro-screen').style.display = 'none';
                }, 1000);
            }, 3000);

            geocoder = new google.maps.Geocoder();
            const startPos = { lat: 37.5665, lng: 126.9780 };
            map = new google.maps.Map(document.getElementById("map"), {
                zoom: 16, center: startPos, disableDefaultUI: false, clickableIcons: false
            });

            loadConquests();

            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition((position) => {
                    const pos = { lat: position.coords.latitude, lng: position.coords.longitude };
                    map.setCenter(pos);
                    new google.maps.Marker({ position: pos, map: map, label: { text: "ğŸ¿ï¸", fontSize: "30px" }, zIndex: 999 });
                });
            }
        }

        function conquerCurrentLocation() {
            if (!navigator.geolocation) { alert("ìœ„ì¹˜ ì •ë³´ë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤."); return; }
            navigator.geolocation.getCurrentPosition((position) => {
                const lat = position.coords.latitude;
                const lng = position.coords.longitude;
                geocoder.geocode({ location: { lat, lng } }, (results, status) => {
                    let country = "ë¯¸ì§€ì˜ ë•…", region = "ì–´ë”˜ê°€", flag = "ğŸ³ï¸";
                    if (status === "OK" && results[0]) {
                        results[0].address_components.forEach(comp => {
                            if (comp.types.includes("country")) {
                                country = comp.long_name;
                                if(country === "ëŒ€í•œë¯¼êµ­") flag = "ğŸ‡°ğŸ‡·";
                                else if(country === "ë¯¸êµ­") flag = "ğŸ‡ºğŸ‡¸";
                                else if(country === "ì¼ë³¸") flag = "ğŸ‡¯ğŸ‡µ";
                                else flag = "ğŸš©";
                            }
                            if (comp.types.includes("administrative_area_level_1")) region = comp.long_name;
                        });
                    }
                    const newConquest = {
                        id: Date.now(), lat: lat, lng: lng,
                        time: new Date().toLocaleDateString() + " " + new Date().toLocaleTimeString(),
                        country: country, region: region, flag: flag,
                        placeName: `${region}ì˜ ì •ë³µì§€`, note: "ì˜ì—­ í‘œì‹œ ì™„ë£Œ! ì¾Œì í–ˆìŒ."
                    };
                    let list = getList(); list.push(newConquest); saveList(list); addMarker(newConquest);
                    if(navigator.vibrate) navigator.vibrate(200);
                    alert("ì •ë³µ ì™„ë£Œ! ğŸ¿ï¸\nì§€êµ¬ ì •ë³µì— í•œ ë°œì§ ë‹¤ê°€ê°”ìŠµë‹ˆë‹¤.");
                });
            });
        }

        function addMarker(data) {
            const marker = new google.maps.Marker({
                position: { lat: data.lat, lng: data.lng }, map: map, label: { text: "ğŸ’©", fontSize: "20px" }
            });
            const infoWindow = new google.maps.InfoWindow({ content: `<div style="text-align:center;"><b>${data.placeName}</b><br>${data.time}</div>` });
            marker.addListener("click", () => infoWindow.open(map, marker));
        }

        function getList() { return JSON.parse(localStorage.getItem('conquestList')) || []; }
        function saveList(list) { localStorage.setItem('conquestList', JSON.stringify(list)); renderList(); }
        function loadConquests() { getList().forEach(item => addMarker(item)); renderList(); }

        function renderList() {
            const list = getList().reverse();
            const container = document.getElementById('log-list-area');
            container.innerHTML = "";
            document.getElementById('total-count').innerText = `${list.length}ê³³ ì •ë³µí•¨`;
            const countryCounts = {};
            list.forEach(item => { countryCounts[item.country] = (countryCounts[item.country] || 0) + 1; });
            let statsText = [];
            for (const [country, count] of Object.entries(countryCounts)) statsText.push(`${country} ${count}`);
            document.getElementById('country-stats').innerText = statsText.join('  |  ');
            list.forEach(item => {
                const div = document.createElement('div'); div.className = 'log-item';
                div.innerHTML = `
                    <div class="log-header"><div><span style="font-size:24px; margin-right:5px;">${item.flag}</span> <span class="log-place">${item.placeName}</span></div><button class="btn-edit" onclick="openEditModal(${item.id})">âœ</button></div>
                    <div style="font-size:12px; color:#777; margin-bottom:8px;">${item.country} ${item.region} | ${item.time}</div>
                    <div class="log-note">${item.note}</div>
                `;
                container.appendChild(div);
            });
        }

        function openEditModal(id) {
            const item = getList().find(x => x.id === id);
            if(item) {
                document.getElementById('edit-id').value = id;
                document.getElementById('edit-place').value = item.placeName;
                document.getElementById('edit-note').value = item.note;
                document.getElementById('edit-modal').style.display = 'flex';
            }
        }
        function closeModal() { document.getElementById('edit-modal').style.display = 'none'; }
        function saveEdit() {
            const id = parseInt(document.getElementById('edit-id').value);
            let list = getList();
            const index = list.findIndex(x => x.id === id);
            if(index !== -1) {
                list[index].placeName = document.getElementById('edit-place').value;
                list[index].note = document.getElementById('edit-note').value;
                saveList(list); closeModal();
            }
        }
        function deleteLog() {
            if(confirm("ì •ë³µ ê¸°ë¡ì„ ì§€ìš°ì‹œê² ìŠµë‹ˆê¹Œ?")) {
                const id = parseInt(document.getElementById('edit-id').value);
                let list = getList();
                list = list.filter(x => x.id !== id);
                saveList(list); closeModal(); location.reload();
            }
        }
        function switchTab(tabName) {
            if (tabName === 'map') {
                document.getElementById('map-container').style.display = 'block';
                document.getElementById('list-container').style.display = 'none';
                document.getElementById('tab-map').classList.add('active');
                document.getElementById('tab-list').classList.remove('active');
            } else {
                document.getElementById('map-container').style.display = 'none';
                document.getElementById('list-container').style.display = 'block';
                document.getElementById('tab-map').classList.remove('active');
                document.getElementById('tab-list').classList.add('active');
                renderList();
            }
        }
    </script>
</body>
</html>
